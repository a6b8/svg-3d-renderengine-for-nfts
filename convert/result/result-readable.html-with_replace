
<!DOCTYPE html>
<html>
    <header>
    </header>
    <body>
        <svg id="2d" width="400" height="400"></svg>
        <canvas id="3d" width="400" height="400"></canvas>
        <script>class __0{constructor(t,_,s){this.x=t,this.y=_,this.z=s,this.w=1}}class __1{constructor(t,_,s,e,i,a,n,r,o){this.p0=new __0(t,_,s),this.p1=new __0(e,i,a),this.p2=new __0(n,r,o),this.color=0}}class __2{constructor(t){this.tris=[],t.forEach((t=>{let _=new __1(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]);this.tris.push(_)}))}}class __3{constructor(){this.m=new Array(4).fill(0).map((()=>new Array(4).fill(0)))}}class __4{add(t,_){return new __0(t.x+_.x,t.y+_.y,t.z+_.z)}sub(t,_){return new __0(t.x-_.x,t.y-_.y,t.z-_.z)}mul(t,_){return new __0(t.x*_,t.y*_,t.z*_)}div(t,_){return new __0(t.x/_,t.y/_,t.z/_)}__5(t,_){return t.x*_.x+t.y*_.y+t.z*_.z}length(t){return Math.sqrt(this.__5(t,t))}__6(t){const _=this.length(t);return new __0(t.x/_,t.y/_,t.z/_)}__7(t,_){return new __0(t.y*_.z-t.z*_.y,t.z*_.x-t.x*_.z,t.x*_.y-t.y*_.x)}__8(t,_,s,e){_=vc.__6(_);const i=-__5(_,t),a=__5(s,_),n=(-i-a)/(__5(e,_)-a),r=vc.sub(e,s),o=vc.mul(r,n);return vc.add(s,o)}}class Matrix{constructor(){this.vc=new __4}multiply__4(t,_){const s=new __0;return s.x=_.x*t.m[0][0]+_.y*t.m[1][0]+_.z*t.m[2][0]+_.w*t.m[3][0],s.y=_.x*t.m[0][1]+_.y*t.m[1][1]+_.z*t.m[2][1]+_.w*t.m[3][1],s.z=_.x*t.m[0][2]+_.y*t.m[1][2]+_.z*t.m[2][2]+_.w*t.m[3][2],s.w=_.x*t.m[0][3]+_.y*t.m[1][3]+_.z*t.m[2][3]+_.w*t.m[3][3],s}__10(){const t=new __3;return t.m[0][0]=1,t.m[1][1]=1,t.m[2][2]=1,t.m[3][3]=1,t}__11(t){const _=new __3;return _.m[0][0]=1,_.m[1][1]=Math.cos(t),_.m[1][2]=Math.sin(t),_.m[2][1]=-Math.sin(t),_.m[2][2]=Math.cos(t),_.m[3][3]=1,_}__12(t){const _=new __3;return _.m[0][0]=Math.cos(t),_.m[0][2]=Math.sin(t),_.m[2][0]=-Math.sin(t),_.m[1][1]=1,_.m[2][2]=Math.cos(t),_.m[3][3]=1,_}__13(t){const _=new __3;return _.m[0][0]=Math.cos(t),_.m[0][1]=Math.sin(t),_.m[1][0]=-Math.sin(t),_.m[1][1]=Math.cos(t),_.m[2][2]=1,_.m[3][3]=1,_}__14(t,_,s){const e=new __3;return e.m[0][0]=1,e.m[1][1]=1,e.m[2][2]=1,e.m[3][3]=1,e.m[3][0]=t,e.m[3][1]=_,e.m[3][2]=s,e}__15(t,_,s,e){const i=1/Math.tan(.5*t/180*3.14159),a=new __3;return a.m[0][0]=_*i,a.m[1][1]=i,a.m[2][2]=e/(e-s),a.m[3][2]=-e*s/(e-s),a.m[2][3]=1,a.m[3][3]=0,a}__16(t,_){const s=new __3;for(let e=0;e<4;e++)for(let i=0;i<4;i++)s.m[i][e]=t.m[i][0]*_.m[0][e]+t.m[i][1]*_.m[1][e]+t.m[i][2]*_.m[2][e]+t.m[i][3]*_.m[3][e];return s}__24(t,_,s){let e=this.vc.sub(_,t);e=this.vc.__6(e);const i=this.vc.mul(e,this.vc.__5(s,e));let a=this.vc.sub(s,i);a=this.vc.__6(a);const n=this.vc.__7(a,e),r=new __3;return r.m[0][0]=n.x,r.m[0][1]=n.y,r.m[0][2]=n.z,r.m[0][3]=0,r.m[1][0]=a.x,r.m[1][1]=a.y,r.m[1][2]=a.z,r.m[1][3]=0,r.m[2][0]=e.x,r.m[2][1]=e.y,r.m[2][2]=e.z,r.m[2][3]=0,r.m[3][0]=t.x,r.m[3][1]=t.y,r}__25(t){const _=new __3;return _.m[0][0]=t.m[0][0],_.m[0][1]=t.m[1][0],_.m[0][2]=t.m[2][0],_.m[0][3]=0,_.m[1][0]=t.m[0][1],_.m[1][1]=t.m[1][1],_.m[1][2]=t.m[2][1],_.m[1][3]=0,_.m[2][0]=t.m[0][2],_.m[2][1]=t.m[1][2],_.m[2][2]=t.m[2][2],_.m[2][3]=0,_.m[3][0]=-(t.m[3][0]*_.m[0][0]+t.m[3][1]*_.m[1][0]+t.m[3][2]*_.m[2][0]),_.m[3][1]=-(t.m[3][0]*_.m[0][1]+t.m[3][1]*_.m[1][1]+t.m[3][2]*_.m[2][1]),_.m[3][2]=-(t.m[3][0]*_.m[0][2]+t.m[3][1]*_.m[1][2]+t.m[3][2]*_.m[2][2]),_.m[3][3]=1,_}}function __1_ClipAgainstPlane(t,_,s,e,i){function a(s){n.__6(s);return _.x*s.x+_.y*s.y+_.z*s.z-n.__5(_,t)}const n=new __4;_=n.__6(_);let r=new Array(3).fill(new __0),o=0,m=new Array(3).fill(new __0),h=0;const l=a(s.p0),c=a(s.p1),p=a(s.p2);return l>=0?(o++,r[o]=s.p0):(h++,m[h]=s.p0),c>=0?(o++,r[o]=s.p1):(h++,m[h]=s.p1),p>=0?(o++,r[o]=s.p2):(h++,m[h]=s.p2),0==o?0:3==o?(e=s,1):1==o&&2==h?(e.color=s.color,e.p0=r[0],e.p1=n.__8(t,_,r[0],m[0]),e.p2=n.__8(t,_,r[0],m[1]),1):2==o&&1==h?(e.color=s.color,i.color=s.color,e.p0=r[0],e.p1=r[1],e.p2=n.__8(t,_,r[0],m[0]),i.p0=r[1],i.p1=e.p2,i.p2=n.__8(t,_,r[1],m[0]),2):void 0}const __27=class{constructor(){this.__44={render:{loop:1,animate:10,elapse_time:.03},mesh:{file:"./version/7-class/polyhedron.obj",load_from_file:0,scale:.85,float_size:0},canvas:{width:400,height:400},camera:{position:{x:2.5,y:2,z:0},look_at:{yaw:0,distance:""}},style:{color:{background:"lightGrey"},stroke:{width:1,color:"black"},shadow:{range:200}}},this.vCamera,this.elapsedTime,this.vLookDir,this.canvas,this.svg,this.ctx}__28(){this.vCamera=new __0(this.__44.camera.position.x,this.__44.camera.position.y,this.__44.camera.position.z),this.elapsedTime=0,this.vLookDir=new __0}initDom(){[["svg","2d"],["canvas","3d"]].forEach((t=>{let _=document.createElement(t[0]);_.id=t[1],_.setAttribute("width",this.__44.canvas.width),_.setAttribute("height",this.__44.canvas.height),document.body.appendChild(_);document.getElementById(t[1])}));this.canvas=document.getElementById("3d"),this.svg=document.getElementById("2d"),this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle=this.__44.style.color.background,this.ctx.fillRect(0,0,this.__44.canvas.width,this.__44.canvas.height),this.ctx.lineWidth=this.__44.style.stroke.width,this.ctx.strokeStyle=this.__44.style.stroke.color}__29(){window.addEventListener("keydown",(t=>{if(t.defaultPrevented)return;let _=0;switch(t.key){case"ArrowDown":this.__44.camera.position.y-=1,_=1;break;case"ArrowUp":this.__44.camera.position.y+=1,_=1;break;case"ArrowLeft":this.__44.camera.position.x+=1,_=1;break;case"ArrowRight":this.__44.camera.position.x-=1,_=1;break;case"w":this.__44.camera.look_at.distance="forward",_=1;break;case"a":this.__44.camera.look_at.yaw-=-.1,_=1;break;case"s":this.__44.camera.look_at.distance="backward",_=1;break;case"d":this.__44.camera.look_at.yaw+=-.1,_=1;break;default:return}this.__44.render.loop||1!=_||this.__42({__35:__35,mesh:mesh}),t.preventDefault()}),1)}meshCube(){return[[0,0,0,0,1,0,1,1,0],[0,0,0,1,1,0,1,0,0],[1,0,0,1,1,0,1,1,1],[1,0,0,1,1,1,1,0,1],[1,0,1,1,1,1,0,1,1],[1,0,1,0,1,1,0,0,1],[0,0,1,0,1,1,0,1,0],[0,0,1,0,1,0,0,0,0],[0,1,0,0,1,1,1,1,1],[0,1,0,1,1,1,1,1,0],[1,0,1,0,0,1,0,0,0],[1,0,1,0,0,0,1,0,0]]}meshLoader(t){let _=t.split("\n"),s=[],e=[];_.forEach((t=>{if(t.startsWith("v ")){let _=t.split(" ");_.shift(),_=_.map((t=>parseFloat(t))),s.push(_)}if(t.startsWith("f ")){let _=t.split(" ");_.shift(),_=_.map((t=>parseFloat(t))),e.push(_)}}));let i={x:{a:s.map((t=>t[0])),min:null,max:null,delta:null},y:{a:s.map((t=>t[1])),min:null,max:null,delta:null},z:{a:s.map((t=>t[2])),min:null,max:null,delta:null}},a=[["x","y","z"],["min","max"]];a[0].forEach((t=>{a[1].forEach((_=>{switch(_){case"min":i[t][_]=Math.min(...i[t].a);break;case"max":i[t][_]=Math.max(...i[t].a)}})),i[t].delta=i[t].max-i[t].min}));for(let t=0;t<s.length;t++)s[t][0]=(s[t][0]-i.x.min)/i.x.delta,s[t][1]=(s[t][1]-i.y.min)/i.y.delta,s[t][2]=(s[t][2]-i.z.min)/i.z.delta;return e.map((t=>[s[t[0]-1][0],s[t[0]-1][1],s[t[0]-1][2],s[t[1]-1][0],s[t[1]-1][1],s[t[1]-1][2],s[t[2]-1][0],s[t[2]-1][1],s[t[2]-1][2]]))}__31({__33:t,__34:_}){return(new Matrix).__15(90,t/_,.1,1e3)}__32({__35:t,__2Cube:_,__37:s,__34:e,__33:i}){const a=new Matrix,n=new __4,r=n.mul(this.vLookDir,8*s);switch(this.__44.camera.look_at.distance){case"forward":this.vCamera=n.add(this.vCamera,r),this.__44.camera.look_at.distance="";break;case"backward":this.vCamera=n.sub(this.vCamera,r),this.__44.camera.look_at.distance=""}const o=1*s,m=a.__13(.5*o),h=a.__11(o);this.vCamera.x=this.__44.camera.position.x,this.vCamera.y=this.__44.camera.position.y;const l=a.__14(0,0,5);let c=new __3;c=a.__10(),c=a.__16(m,h),c=a.__16(c,l);const p=new __0(0,1,0);let d=new __0(0,0,1);const w=a.__12(this.__44.camera.look_at.yaw);this.vLookDir=a.multiply__4(w,d),d=n.add(this.vCamera,this.vLookDir);const u=a.__24(this.vCamera,d,p),y=a.__25(u);let x=[];return _.tris.forEach((_=>{const s=new __1,r=new __1,o=new __1;r.p0=a.multiply__4(c,_.p0),r.p1=a.multiply__4(c,_.p1),r.p2=a.multiply__4(c,_.p2);const m=n.sub(r.p1,r.p0),h=n.sub(r.p2,r.p0);let l=n.__7(m,h);l=n.__6(l);const p=n.sub(r.p0,this.vCamera);if(n.__5(l,p)<0){let _=new __0(0,1,-1);_=n.__6(_);const m=Math.max(.1,n.__5(_,l));r.color=Math.floor(m*this.__44.style.shadow.range),o.p0=a.multiply__4(y,r.p0),o.p1=a.multiply__4(y,r.p1),o.p2=a.multiply__4(y,r.p2),o.color=r.color;const h=new __0(0,0,.1),c=new __0(0,0,1),p=new Array(2).fill(new __1),d=__1_ClipAgainstPlane(h,c,o,p[0],p[1]);for(let t=0;t<d;t++);s.p0=a.multiply__4(t,o.p0),s.p1=a.multiply__4(t,o.p1),s.p2=a.multiply__4(t,o.p2),s.color=r.color,s.p0=n.div(s.p0,s.p0.w),s.p1=n.div(s.p1,s.p1.w),s.p2=n.div(s.p2,s.p2.w);const w=new __0(1,1,0);s.p0=n.add(s.p0,w),s.p1=n.add(s.p1,w),s.p2=n.add(s.p2,w),s.p0.x*=this.__44.mesh.scale*e,s.p0.y*=this.__44.mesh.scale*i,s.p1.x*=this.__44.mesh.scale*e,s.p1.y*=this.__44.mesh.scale*i,s.p2.x*=this.__44.mesh.scale*e,s.p2.y*=this.__44.mesh.scale*i;let u=[["p0","p1","p2"],["x","y","z"]];u[0].forEach((t=>{u[1].forEach((_=>{s[t][_]=Number.parseFloat(s[t][_]).toFixed(this.__44.mesh.float_size)}))})),x.push(this.draw__1SVG(s))}})),x}draw__1SVG(t){return this.ctx.beginPath(),this.ctx.moveTo(t.p0.x,t.p0.y),this.ctx.lineTo(t.p1.x,t.p1.y),this.ctx.lineTo(t.p2.x,t.p2.y),this.ctx.lineTo(t.p0.x,t.p0.y),this.ctx.closePath(),this.ctx.fillStyle=`rgb(${t.color},${t.color},${t.color})`,this.ctx.stroke(),this.ctx.fill(),`<polygon __30="${t.p0.x},${t.p0.y} ${t.p1.x},${t.p1.y} ${t.p2.x},${t.p2.y}" stroke="${this.__44.style.stroke.color}" fill="rgb(${t.color}, ${t.color}, ${t.color})" stroke-width="${this.__44.style.stroke.width}"\n        stroke-linecap="butt" stroke-linejoin="round" class="triangle" />`}__42({__35:t,mesh:_}){this.elapsedTime+=this.__44.render.elapse_time,this.ctx.fillStyle=this.__44.style.color.background,this.ctx.fillRect(0,0,this.__44.canvas.width,this.__44.canvas.height);let s=this.__32({__35:t,__2Cube:_,__37:this.elapsedTime,__34:this.__44.canvas.width,__33:this.__44.canvas.height});this.svg.innerHTML=s.join("\n")}async __43(){let t=null;if(this.__44.mesh.load_from_file){const _=await fetch(this.__44.mesh.file),s=await _.text();t=this.meshLoader(s)}else t=this.meshCube();const _=new __2(t),s=this.__31({__33:this.__44.canvas.height,__34:this.__44.canvas.width});if(this.__42({__35:s,mesh:_}),this.__44.render.loop){window.setInterval((()=>{this.__42({__35:s,mesh:_})}),this.__44.render.animate)}}async start(){this.__28(),this.initDom(),this.__29(),await this.__43()}};document.addEventListener("DOMContentLoaded",(async t=>{const _=new __27;await _.start()}));</script>
    </body>
</html>
